import{r as i,b as p,a as f,j as e}from"./index-BrkXOzuL.js";import{d as R}from"./dayjs.min-wTeVztoK.js";import{s as x,R as se,a as te,F as m}from"./EditOutlined-B4eHr5ZT.js";import{z as P,H as L,E as h,B as j,F as V,A as ne,bk as ae,G as ie}from"./AntdIcon-OpYKIL51.js";import{R as re}from"./SearchOutlined-CQ5rAT1e.js";import{D as C}from"./index-D_AKy5U6.js";import{R as le,A as z}from"./PlusOutlined-vTJKJfm-.js";import{R as N,D as oe}from"./TeamOutlined-B631n3ik.js";import{R as ce,a as de,M as me}from"./CloseOutlined-Jt9rCDlK.js";import{R as ue}from"./FileTextOutlined-iBFVrhda.js";import"./index-s-XDWVxl.js";import"./index-DcAOwtUU.js";var he={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M574 665.4a8.03 8.03 0 00-11.3 0L446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3l-39.8-39.8a8.03 8.03 0 00-11.3 0L191.4 526.5c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3L574 665.4zm258.6-474c-84.6-84.6-221.5-84.6-306 0L410.3 307.6a8.03 8.03 0 000 11.3l39.7 39.7c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204L665.3 562.6a8.03 8.03 0 000 11.3l39.8 39.8c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c84.5-84.6 84.5-221.5 0-306.1zM610.1 372.3a8.03 8.03 0 00-11.3 0L372.3 598.7a8.03 8.03 0 000 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l226.4-226.4c3.1-3.1 3.1-8.2 0-11.3l-39.5-39.6z"}}]},name:"link",theme:"outlined"},xe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M920 760H336c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0-568H336c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H336c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM216 712H100c-2.2 0-4 1.8-4 4v34c0 2.2 1.8 4 4 4h72.4v20.5h-35.7c-2.2 0-4 1.8-4 4v34c0 2.2 1.8 4 4 4h35.7V838H100c-2.2 0-4 1.8-4 4v34c0 2.2 1.8 4 4 4h116c2.2 0 4-1.8 4-4V716c0-2.2-1.8-4-4-4zM100 188h38v120c0 2.2 1.8 4 4 4h40c2.2 0 4-1.8 4-4V152c0-4.4-3.6-8-8-8h-78c-2.2 0-4 1.8-4 4v36c0 2.2 1.8 4 4 4zm116 240H100c-2.2 0-4 1.8-4 4v36c0 2.2 1.8 4 4 4h68.4l-70.3 77.7a8.3 8.3 0 00-2.1 5.4V592c0 2.2 1.8 4 4 4h116c2.2 0 4-1.8 4-4v-36c0-2.2-1.8-4-4-4h-68.4l70.3-77.7a8.3 8.3 0 002.1-5.4V432c0-2.2-1.8-4-4-4z"}}]},name:"ordered-list",theme:"outlined"};function $(){return $=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var l=arguments[r];for(var o in l)Object.prototype.hasOwnProperty.call(l,o)&&(t[o]=l[o])}return t},$.apply(this,arguments)}const pe=(t,r)=>i.createElement(P,$({},t,{ref:r,icon:he})),fe=i.forwardRef(pe);function A(){return A=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var l=arguments[r];for(var o in l)Object.prototype.hasOwnProperty.call(l,o)&&(t[o]=l[o])}return t},A.apply(this,arguments)}const ge=(t,r)=>i.createElement(P,A({},t,{ref:r,icon:xe})),je=i.forwardRef(ge),{Option:g}=L,{RangePicker:ve}=C,{TextArea:Oe}=h,Ge=()=>{const[t,r]=i.useState([]),[l,o]=i.useState([]),[a,b]=i.useState(null),[v,u]=i.useState(!1),[c,H]=i.useState(""),[q,I]=i.useState([]),[Y,S]=i.useState(!1),[E,O]=i.useState(null),[w,G]=i.useState("create"),[ke,T]=i.useState("all"),[ye,_]=i.useState([]);i.useEffect(()=>{B()},[]),i.useEffect(()=>{a?D(a):(r([]),I([]))},[a]);const B=async()=>{try{const s=await p.get(`${f}Group`);o(s.data.data||[])}catch{x.error("Failed to load groups")}},D=async s=>{u(!0);try{const n=await p.get(`${f}GroupLesson/${s}/sessions`);r(n.data.data||[]),I(n.data.data||[])}catch{H("Failed to load sessions")}u(!1)},k=i.useMemo(()=>{const s=t.length,n=t.filter(F=>F.isActive).length,d=s-n,Z=t.length>0?(t.reduce((F,ee)=>{var M;return F+(((M=ee.attendees)==null?void 0:M.length)||0)},0)/t.length).toFixed(1):0;return{totalSessions:s,activeSessions:n,inactiveSessions:d,avgAttendees:Z}},[t]),U=s=>{const n=t.filter(d=>d.name.toLowerCase().includes(s.toLowerCase()));I(n)},K=()=>{G("create"),O(null),S(!0)},J=s=>{G("edit"),O(s),S(!0)},Q=async s=>{u(!0);try{await p.delete(`${f}GroupLesson/sessions/${s}`),x.success("Session deleted successfully!"),D(a)}catch{x.error("Failed to delete session")}u(!1)},W=async s=>{u(!0);try{const n=a,d={title:s.name,sessionLink:s.sessionLink,videoLink:s.sessionLink,assignmentLink:s.assignmentLink,sessionDate:s.date?s.date.format?s.date.format("YYYY-MM-DDTHH:mm:ss"):s.date:null,assignmentDeadline:s.assignmentDeadline?s.assignmentDeadline.format?s.assignmentDeadline.format("YYYY-MM-DDTHH:mm:ss"):s.assignmentDeadline:null,order:s.order,courseGroupId:n};w==="create"?(await p.post(`${f}GroupLesson/${n}/sessions`,d),x.success("Session created successfully!")):(await p.put(`${f}GroupLesson/Sessions/${E.id}`,d),x.success("Session updated successfully!")),S(!1),D(a)}catch{x.error("Failed to save session")}u(!1)},X=[{title:"Session Name",dataIndex:"name",key:"name",render:(s,n)=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(z,{style:{backgroundColor:n.isActive?"#1890ff":"#f5222d"},icon:e.jsx(N,{}),className:"mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s||n.title}),n.description&&e.jsx("div",{className:"text-gray-500 text-xs truncate max-w-xs",children:n.description})]})]})},{title:"Order",dataIndex:"order",key:"order",render:s=>e.jsxs("span",{children:[e.jsx(je,{className:"mr-1"}),s]})},{title:"Session Link",dataIndex:"sessionLink",key:"sessionLink",render:(s,n)=>{const d=s||n.videoLink;return d?e.jsx("a",{href:d,target:"_blank",rel:"noopener noreferrer",children:e.jsx(fe,{})}):"-"}},{title:"Assignment Link",dataIndex:"assignmentLink",key:"assignmentLink",render:s=>s?e.jsx("a",{href:s,target:"_blank",rel:"noopener noreferrer",children:e.jsx(ue,{})}):"-"},{title:"Assignment Deadline",dataIndex:"assignmentDeadline",key:"assignmentDeadline",render:s=>e.jsx("span",{children:s})},{title:"Date",dataIndex:"date",key:"date",render:(s,n)=>{const d=s||n.sessionDate;return d?e.jsx("span",{children:d}):"-"}},{title:"Actions",key:"actions",render:(s,n)=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(j,{icon:e.jsx(se,{}),onClick:()=>J(n)}),e.jsx(j,{icon:e.jsx(te,{}),danger:!0,onClick:()=>Q(n.id)})]})}];return e.jsxs("div",{className:"session-dashboard p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Session Management"}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsxs("div",{className:"flex space-x-4",children:[e.jsx(L,{placeholder:"Select group",style:{width:200},value:a,onChange:b,allowClear:!0,showSearch:!0,optionFilterProp:"children",children:l.map(s=>e.jsx(g,{value:s.id,children:s.name},s.id))}),e.jsx(h,{placeholder:"Search sessions...",prefix:e.jsx(re,{}),onChange:s=>U(s.target.value),className:"w-64",disabled:!a}),e.jsxs(L,{defaultValue:"all",style:{width:120},onChange:s=>T(s),disabled:!a,children:[e.jsx(g,{value:"all",children:"All Status"}),e.jsx(g,{value:"active",children:"Active"}),e.jsx(g,{value:"inactive",children:"Inactive"})]}),e.jsx(ve,{onChange:(s,n)=>_(n),placeholder:["Start Date","End Date"],disabled:!a})]}),e.jsx(j,{type:"primary",icon:e.jsx(le,{}),onClick:K,disabled:!a,children:"New Session"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(y,{title:"Total Sessions",value:k.totalSessions,icon:e.jsx(N,{}),color:"#1890ff",isDecimal:!1}),e.jsx(y,{title:"Active Sessions",value:k.activeSessions,icon:e.jsx(ce,{}),color:"#52c41a",isDecimal:!1}),e.jsx(y,{title:"Inactive Sessions",value:k.inactiveSessions,icon:e.jsx(de,{}),color:"#f5222d",isDecimal:!1}),e.jsx(y,{title:"Avg Attendees",value:k.avgAttendees,icon:e.jsx(N,{}),color:"#faad14",isDecimal:!0})]}),e.jsx(V,{children:e.jsx(ne,{spinning:v,children:c?e.jsx(ae,{description:c}):e.jsx(ie,{columns:X,dataSource:q,rowKey:"id",pagination:{pageSize:10},scroll:{x:"max-content"}})})}),e.jsx(me,{title:w==="create"?"Create New Session":"Edit Session",open:Y,onCancel:()=>S(!1),footer:null,width:800,destroyOnClose:!0,children:e.jsx(Se,{session:E,groups:l,onSubmit:W,actionType:w})})]})},y=({title:t,value:r,icon:l,color:o,isDecimal:a})=>e.jsxs(V,{className:"flex items-center p-4",children:[e.jsx("div",{className:"mr-4",children:e.jsx(z,{style:{backgroundColor:o},icon:l})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold",children:a?parseFloat(r).toFixed(2):r}),e.jsx("div",{className:"text-gray-500",children:t})]})]}),Se=({session:t,groups:r,onSubmit:l,actionType:o})=>{const[a]=m.useForm(),[b,v]=i.useState(!1);i.useEffect(()=>{t?a.setFieldsValue({groupId:t.groupId||t.courseGroupId,name:t.name||t.title||"",description:t.description||"",sessionLink:t.sessionLink||"",videoLink:t.videoLink||"",assignmentLink:t.assignmentLink||"",order:t.order,date:t.date?typeof t.date=="string"?R(t.date):t.date:t.sessionDate?typeof t.sessionDate=="string"?R(t.sessionDate):t.sessionDate:null,assignmentDeadline:t.assignmentDeadline?typeof t.assignmentDeadline=="string"?R(t.assignmentDeadline):t.assignmentDeadline:null}):a.resetFields()},[t,a]);const u=async()=>{try{v(!0);const c=await a.validateFields();await l({...c})}catch(c){console.error("Validation failed:",c)}finally{v(!1)}};return e.jsxs(m,{form:a,layout:"vertical",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(m.Item,{name:"groupId",label:"Group",rules:[{required:!0,message:"Please select a group"}],children:e.jsx(L,{placeholder:"Select group",showSearch:!0,optionFilterProp:"children",disabled:o==="edit",children:r.map(c=>e.jsx(g,{value:c.id,children:c.name},c.id))})}),e.jsx(m.Item,{name:"name",label:"Session Name",rules:[{required:!0,message:"Please input session name"}],children:e.jsx(h,{placeholder:"Enter session name"})}),e.jsx(m.Item,{name:"order",label:"Order",rules:[{required:!0,message:"Please input session order"}],children:e.jsx(h,{type:"number",placeholder:"Enter session order",min:1})}),e.jsx(m.Item,{name:"sessionLink",label:"Session Link",rules:[{required:!0,message:"Please input session link"}],children:e.jsx(h,{placeholder:"Enter session link"})}),e.jsx(m.Item,{name:"videoLink",label:"Video Link",rules:[{required:!0,message:"Please input video link"}],children:e.jsx(h,{placeholder:"Enter video link"})}),e.jsx(m.Item,{name:"assignmentLink",label:"Assignment Link",rules:[{required:!0,message:"Please input assignment link"}],children:e.jsx(h,{placeholder:"Enter assignment link"})}),e.jsx(m.Item,{name:"assignmentDeadline",label:"Assignment Deadline",rules:[{required:!0,message:"Please select assignment deadline"}],children:e.jsx(C,{style:{width:"100%"}})}),e.jsx(m.Item,{name:"date",label:"Date",rules:[{required:!0,message:"Please select date"}],children:e.jsx(C,{style:{width:"100%"}})})]}),e.jsx(oe,{}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(j,{onClick:()=>{const c=a.getFieldValue("groupId");a.resetFields(),a.setFieldsValue({groupId:c})},children:"Reset"}),e.jsx(j,{type:"primary",onClick:u,loading:b,children:o==="create"?"Create Session":"Update Session"})]})]})};export{Ge as default};
