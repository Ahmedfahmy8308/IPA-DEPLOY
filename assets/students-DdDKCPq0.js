import{r as l,a as x,j as r}from"./index-Cyiel408.js";import{d as p}from"./dayjs.min-yZpyVJyO.js";import T from"./DashboardLayout-DCmyQTPK.js";import{C as L,I as F}from"./index-CMOpGWy3.js";import{S as C,a as w,F as b}from"./Table-DDNiuuBy.js";import{R as P}from"./SearchOutlined-BUOhp2xA.js";import{D as O}from"./index-Bd-xgwmb.js";import{B as I}from"./index-D4qcYJUV.js";import{I as z}from"./AntdIcon-DkNVMiCV.js";import{T as M}from"./index-Dm9k9Coz.js";import"./avatar-CLn9aj8o.js";import"./chevron-down-BnRArD8w.js";import"./menu-BkwydiBm.js";import"./house-CdyIYo1s.js";import"./settings-ChdQJgjG.js";import"./user-Dek8-off.js";import"./proxy-DOLLqZqS.js";import"./index-8YYtLd1D.js";import"./index-DcAOwtUU.js";import"./useClosable-DU12QjL7.js";var U={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M505.7 661a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V168c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"download",theme:"outlined"};function y(){return y=Object.assign?Object.assign.bind():function(a){for(var n=1;n<arguments.length;n++){var c=arguments[n];for(var s in c)Object.prototype.hasOwnProperty.call(c,s)&&(a[s]=c[s])}return a},y.apply(this,arguments)}const B=(a,n)=>l.createElement(z,y({},a,{ref:n,icon:U})),V=l.forwardRef(B);async function $(){try{const a=await fetch(`${x}StudentEnrollment`,{method:"GET",credentials:"include"});if(!a.ok)throw new Error("Network response was not ok");return(await a.json()).data}catch(a){console.error("Error fetching student enrollment data:",a)}}async function A(){try{const a=await fetch(`${x}StudentEnrollment/export-csv-all`,{method:"GET",credentials:"include"});if(!a.ok)throw new Error("Network response was not ok");const n=await a.blob(),c=window.URL.createObjectURL(n),s=document.createElement("a");s.href=c,s.download="student_enrollment.csv",s.click()}catch(a){console.error("Error downloading CSV file:",a)}}async function H(a){const n=await fetch(`${x}StudentEnrollment/toggle/${a}`,{method:"PUT",credentials:"include"});if(!n.ok)throw new Error("Network response was not ok");return(await n.json()).data}const{Search:Y}=F,{Option:f}=w,{RangePicker:_}=O,me=()=>{const[a,n]=l.useState([]),[c,s]=l.useState(!0),[d,g]=l.useState(""),[m,S]=l.useState(null),[h,v]=l.useState(null),[u,j]=l.useState(null);l.useEffect(()=>{(async()=>{s(!0);try{const i=(await $()||[]).map(o=>({Id:o.id,CourseId:o.courseId,CourseName:o.courseName,Name:o.name,Phone:o.phone,Email:o.email,Faculty:o.faculty,Level:o.level,DateTime:o.dateTime,IsReaded:o.isReaded}));n(i)}catch(t){console.error("Error fetching data:",t)}finally{s(!1)}})()},[]);const E=l.useMemo(()=>a.filter(e=>{const t=d===""||e.Name.toLowerCase().includes(d.toLowerCase())||e.Email.toLowerCase().includes(d.toLowerCase())||e.Phone.includes(d)||e.CourseName.toLowerCase().includes(d.toLowerCase()),i=m===null||e.CourseName===m,o=h===null||e.IsReaded===h,R=u===null||p(e.DateTime).isAfter(u[0].startOf("day"))&&p(e.DateTime).isBefore(u[1].endOf("day"));return t&&i&&o&&R}),[a,d,m,h,u]),k=l.useMemo(()=>{const e=new Set(a.map(t=>t.CourseName));return Array.from(e)},[a]),D=()=>{A()},N=[{title:"ID",dataIndex:"Id",key:"Id",sorter:(e,t)=>e.Id-t.Id},{title:"Name",dataIndex:"Name",key:"Name",sorter:(e,t)=>e.Name.localeCompare(t.Name)},{title:"Course",dataIndex:"CourseName",key:"CourseName",sorter:(e,t)=>e.CourseName.localeCompare(t.CourseName)},{title:"Email",dataIndex:"Email",key:"Email"},{title:"Phone",dataIndex:"Phone",key:"Phone"},{title:"Faculty",dataIndex:"Faculty",key:"Faculty",sorter:(e,t)=>e.Faculty.localeCompare(t.Faculty)},{title:"Level",dataIndex:"Level",key:"Level",sorter:(e,t)=>e.Level.localeCompare(t.Level)},{title:"Date",dataIndex:"DateTime",key:"DateTime",render:e=>p(e).format("YYYY-MM-DD HH:mm"),sorter:(e,t)=>new Date(e.DateTime).getTime()-new Date(t.DateTime).getTime()},{title:"Status",dataIndex:"IsReaded",key:"IsReaded",render:e=>r.jsx(M,{color:e?"green":"orange",children:e?"Read":"Unread"}),filters:[{text:"Read",value:!0},{text:"Unread",value:!1}],onFilter:(e,t)=>t.IsReaded===e},{title:"Action",key:"action",render:(e,t)=>r.jsx(C,{size:"middle",children:r.jsx(I,{type:"link",onClick:async()=>{try{await H(t.Id),n(i=>i.map(o=>o.Id===t.Id?{...o,IsReaded:!o.IsReaded}:o))}catch(i){console.error("Failed to toggle status",i)}},children:"View"})})}];return r.jsx(T,{children:r.jsx("div",{className:"students-page",children:r.jsxs(L,{title:"Students Management",variant:!1,children:[r.jsx("div",{className:"filters-container",style:{marginBottom:20},children:r.jsxs(C,{size:"large",wrap:!0,children:[r.jsx(Y,{placeholder:"Search students...",allowClear:!0,enterButton:r.jsx(P,{}),size:"large",onSearch:e=>g(e),onChange:e=>g(e.target.value),style:{width:300}}),r.jsx(w,{placeholder:"Filter by course",allowClear:!0,style:{width:200},onChange:e=>S(e),children:k.map(e=>r.jsx(f,{value:e,children:e},e))}),r.jsxs(w,{placeholder:"Filter by status",allowClear:!0,style:{width:150},onChange:e=>v(e),children:[r.jsx(f,{value:!0,children:"Read"}),r.jsx(f,{value:!1,children:"Unread"})]}),r.jsx(_,{showTime:!0,style:{width:300},onChange:e=>j(e)}),r.jsx(I,{type:"primary",icon:r.jsx(V,{}),onClick:D,children:"Export CSV"})]})}),r.jsx(b,{columns:N,dataSource:E,rowKey:"Id",loading:c,pagination:{defaultPageSize:10,showSizeChanger:!0},scroll:{x:"max-content"},variant:!0})]})})})};export{me as default};
