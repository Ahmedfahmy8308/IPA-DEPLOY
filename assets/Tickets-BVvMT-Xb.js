import{r,j as e,b as p,a as j,y as I}from"./index-BuH9qLac.js";import{d as R}from"./dayjs.min-D11p-S4T.js";import{C as O}from"./ConfirmationDialog-B1OwtNOz.js";import{z as V,E as Y,F as A,A as H,bk as P,G as Q,B as u}from"./AntdIcon-BIkPOp9m.js";import{R as h}from"./FileTextOutlined-BZ2v91kP.js";import{R as y,a as k,M as U}from"./CloseOutlined-CgM2Wy7W.js";import"./index-DcAOwtUU.js";import"./index-CTwE-5sh.js";var _={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 110.8V792H136V270.8l-27.6-21.5 39.3-50.5 42.8 33.3h643.1l42.8-33.3 39.3 50.5-27.7 21.5zM833.6 232L512 482 190.4 232l-42.8-33.3-39.3 50.5 27.6 21.5 341.6 265.6a55.99 55.99 0 0068.7 0L888 270.8l27.6-21.5-39.3-50.5-42.7 33.2z"}}]},name:"mail",theme:"outlined"};function w(){return w=Object.assign?Object.assign.bind():function(a){for(var i=1;i<arguments.length;i++){var d=arguments[i];for(var l in d)Object.prototype.hasOwnProperty.call(d,l)&&(a[l]=d[l])}return a},w.apply(this,arguments)}const G=(a,i)=>r.createElement(V,w({},a,{ref:i,icon:_})),M=r.forwardRef(G),se=()=>{const[a,i]=r.useState([]),[d,l]=r.useState(!1),[o,D]=r.useState(""),[v,m]=r.useState(""),[$,C]=r.useState(!1),[n,z]=r.useState(null),[f,g]=r.useState(null),S={0:"Technical Issue",1:"Account Problem",2:"Billing Question",3:"Feedback",4:"Other",TechnicalIssue:"Technical Issue",Accountproblem:"Account Problem",BillingQuestion:"Billing Question",Feedback:"Feedback",Other:"Other"};r.useEffect(()=>{(async()=>{l(!0),m("");try{const s=await p.get(j+"SupportTicket",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});i(s.data.data||[])}catch{m("Failed to fetch tickets")}finally{l(!1)}})()},[]);const T=r.useMemo(()=>o?a.filter(t=>{var s,c,x;return((s=t.title)==null?void 0:s.toLowerCase().includes(o.toLowerCase()))||((c=t.email)==null?void 0:c.toLowerCase().includes(o.toLowerCase()))||((x=t.category)==null?void 0:x.toLowerCase().includes(o.toLowerCase()))}):a,[o,a]),b=r.useMemo(()=>{const t=a.length,s=a.filter(x=>x.read).length,c=t-s;return{total:t,read:s,unread:c}},[a]),B=async t=>{l(!0),m("");try{await p.put(j+`SupportTicket/${t}/mark-read`,{},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),i(s=>s.map(c=>c.id===t?{...c,read:!0}:c))}catch{m("Failed to mark as read")}finally{l(!1)}},L=async t=>{l(!0),m("");try{await p.delete(j+`SupportTicket/${t}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),i(s=>s.filter(c=>c.id!==t)),I.success("Ticket deleted successfully")}catch{m("Failed to delete ticket"),I.error("Failed to delete ticket")}finally{l(!1),g(null)}},E=t=>{z(t),C(!0)},F=[{title:"Title",dataIndex:"title",key:"title",render:t=>e.jsxs("span",{children:[e.jsx(h,{className:"mr-1"}),t]})},{title:"Email",dataIndex:"email",key:"email",render:t=>e.jsxs("span",{children:[e.jsx(M,{className:"mr-1"}),t]})},{title:"Category",dataIndex:"category",key:"category",render:t=>S[t]||t},{title:"Details",dataIndex:"details",key:"details"},{title:"Created At",dataIndex:"createdAt",key:"createdAt",render:t=>t?R(t).format("YYYY-MM-DD HH:mm"):"-"},{title:"Read",dataIndex:"read",key:"read",render:t=>t?e.jsx(y,{}):e.jsx(k,{})},{title:"Actions",key:"actions",render:(t,s)=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(u,{icon:e.jsx(h,{}),onClick:()=>E(s),type:"default",size:"small",children:"View"}),e.jsx(u,{icon:e.jsx(y,{}),onClick:()=>B(s.id),disabled:s.read,type:"primary",size:"small",children:"Mark as Read"}),e.jsx(u,{icon:e.jsx(M,{}),onClick:()=>window.open(`mailto:${s.email}?subject=Re: ${s.title}`),type:"default",size:"small",children:"Reply"}),e.jsx(u,{icon:e.jsx(k,{}),danger:!0,onClick:()=>g(s.id),size:"small",children:"Delete"})]})}];return e.jsxs("div",{className:"tickets-dashboard p-6 bg-gradient-to-br from-blue-50 to-white min-h-screen",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-extrabold text-blue-900 drop-shadow",children:"Support Tickets"}),e.jsx("div",{className:"flex justify-between items-center mt-4",children:e.jsx("div",{className:"flex space-x-4",children:e.jsx(Y,{placeholder:"Search tickets...",onChange:t=>D(t.target.value),className:"w-64 rounded-lg shadow border-blue-200 focus:border-blue-400",allowClear:!0})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx(N,{title:"Total Tickets",value:b.total,icon:e.jsx(h,{}),color:"#1890ff",bg:"bg-blue-100"}),e.jsx(N,{title:"Read",value:b.read,icon:e.jsx(y,{}),color:"#52c41a",bg:"bg-green-100"}),e.jsx(N,{title:"Unread",value:b.unread,icon:e.jsx(k,{}),color:"#f5222d",bg:"bg-red-100"})]}),e.jsx(A,{className:"rounded-xl shadow-lg border-0",children:e.jsxs(H,{spinning:d,children:[v&&e.jsx("div",{className:"text-red-500 mb-2",children:v}),T.length===0?e.jsx(P,{description:"No tickets found"}):e.jsx(Q,{columns:F,dataSource:T,rowKey:"id",pagination:{pageSize:10},scroll:{x:"max-content"},bordered:!0,className:"rounded-lg shadow-md",rowClassName:(t,s)=>`${t.read?"bg-gray-50":"bg-white"} hover:bg-blue-50 transition-all duration-150 ${s%2===0?"even:bg-blue-50/30":""}`})]})}),e.jsx(U,{open:$,onCancel:()=>C(!1),footer:null,title:e.jsxs("span",{className:"flex items-center gap-2 text-xl font-bold text-blue-800",children:[e.jsx(h,{className:"text-blue-400"}),n?n.title:"Ticket Details"]}),width:600,className:"rounded-xl",bodyStyle:{background:"#f9fafb",borderRadius:"0.75rem"},children:n&&e.jsxs("div",{className:"space-y-4 p-1",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("b",{className:"w-24 flex-shrink-0 text-blue-700",children:"Email:"}),e.jsx("span",{className:"text-gray-700",children:n.email})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("b",{className:"w-24 flex-shrink-0 text-blue-700",children:"Category:"}),e.jsx("span",{className:"text-gray-700",children:S[n.category]||n.category})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("b",{className:"w-24 flex-shrink-0 text-blue-700",children:"Created At:"}),e.jsx("span",{className:"text-gray-700",children:R(n.createdAt).format("YYYY-MM-DD HH:mm")})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("b",{className:"w-24 flex-shrink-0 text-blue-700",children:"Status:"}),e.jsx("span",{className:`font-medium ${n.read?"text-green-600":"text-orange-600"}`,children:n.read?"Read":"Unread"})]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsx("div",{className:"font-semibold text-gray-800 mb-2",children:"Details:"}),e.jsx("div",{className:"bg-white p-4 rounded-md text-gray-700 whitespace-pre-line border border-gray-200 shadow-inner",children:n.details})]})]})}),!!f&&e.jsx(O,{open:!!f,title:"Delete Ticket",description:"Are you sure you want to delete this ticket? This action cannot be undone.",onCancel:()=>g(null),onConfirm:()=>L(f),confirmText:"Delete",confirmButtonProps:{danger:!0},loading:d})]})},N=({title:a,value:i,icon:d,color:l,bg:o})=>e.jsxs(A,{className:`flex items-center p-4 shadow-md border-0 rounded-xl ${o||"bg-gray-100"}`,children:[e.jsx("div",{className:"mr-4",children:e.jsx("span",{style:{color:l,fontSize:28},children:d})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-extrabold",style:{color:l},children:i}),e.jsx("div",{className:"text-gray-600 font-medium",children:a})]})]});export{se as default};
