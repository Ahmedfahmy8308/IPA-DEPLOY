import{c as $,j as e,X as Q,r as l,a as k,y as u}from"./index-D_KUTxaW.js";import{B as n}from"./button-OvuP43gu.js";import{C as W,a as Y,c as Z,b as ee,d as se}from"./card-DF951rpD.js";import{I as ae}from"./input-02tcqISh.js";import{T as te,a as re,b as v,c as y,d as le,e as o}from"./table-mE9G-fgy.js";import{B as R}from"./badge-Bf0LcC0C.js";import ie from"./DashboardLayout-DRjBcjbl.js";import{C as ne}from"./ConfirmationDialog-BYmEFZUF.js";import{S as ce,a as oe,b as de,c as me,d as S}from"./select-ZYGAwGoU.js";import{D as xe,a as he,b as ue,c as fe}from"./dialog-DcLNj4d9.js";import{A as pe}from"./index-DJpw51L2.js";import{m as D}from"./proxy-RVCT0Wq0.js";import{M as P}from"./mail-eF5f0C7E.js";import{C as je}from"./clock-DKBBA3I4.js";import{P as ge}from"./phone-CUQnxrJx.js";import{C as T}from"./check-DZtOrqxa.js";import{T as I}from"./trash-2-0HiSfO99.js";import{E as ye}from"./eye-CS3EaOuQ.js";import"./avatar-D-R_yj31.js";import"./chevron-down-H6rY0mfd.js";import"./menu-BGQUB8ly.js";import"./house-C6NN6fJ0.js";import"./settings-DYwBo6MX.js";import"./user-B1QCur1v.js";import"./index-yOCPnRdN.js";import"./Combination-BhD-psms.js";import"./tslib.es6-BUas5LQb.js";import"./index-QXf5UfBP.js";import"./chevron-up-DZYp6c53.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=$("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=$("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=$("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]),we=({message:t,isOpen:x,onClose:c,onMarkAsRead:N,onDelete:f})=>{const b=d=>{const m=new Date(d);return new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(m)},p=d=>{const m=new Date(d),i=Math.floor((new Date().getTime()-m.getTime())/1e3);return i<60?`${i} seconds ago`:i<3600?`${Math.floor(i/60)} minutes ago`:i<86400?`${Math.floor(i/3600)} hours ago`:`${Math.floor(i/86400)} days ago`};return e.jsx(pe,{children:x&&e.jsxs(xe,{open:x,onOpenChange:c,children:[e.jsx(D.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/10 backdrop-blur-sm z-50"}),e.jsx(he,{className:"sm:max-w-2xl overflow-hidden p-0 [&>button.absolute]:hidden rounded-lg",children:e.jsxs(D.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},exit:{y:-20,opacity:0},transition:{type:"spring",damping:20,stiffness:300},className:"bg-white dark:bg-gray-900",children:[e.jsx(ue,{className:"border-b border-gray-200 dark:border-gray-800 p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(fe,{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-full bg-blue-50 dark:bg-blue-900/30",children:e.jsx(P,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:(t==null?void 0:t.subject)||"Message Details"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx(je,{className:"w-4 h-4"}),e.jsx("span",{children:t?p(t.sentDate):""})]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(n,{variant:"ghost",size:"sm",onClick:c,className:"rounded-full p-2 h-9 w-9",children:e.jsx(Q,{size:16})})})]})}),t&&e.jsxs(D.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.1},className:"space-y-6 p-4 sm:p-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 font-medium",children:t.name.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("a",{href:`mailto:${t.email}`,className:"hover:text-blue-600 dark:hover:text-blue-400 transition-colors",children:t.email}),!t.isRead&&e.jsx(R,{className:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400 text-xs",children:"Unread"})]})]})]}),t.phone&&e.jsxs("a",{href:`tel:${t.phone}`,className:"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 transition-colors",children:[e.jsx(ge,{className:"w-4 h-4"}),t.phone]})]}),e.jsx("div",{className:"space-y-1",children:e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Sent: ",b(t.sentDate)]})}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h4",{className:"sr-only",children:"Message"}),e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:t.message.split(`
`).map((d,m)=>e.jsx("p",{children:d},m))})]})}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4 pt-4 border-t border-gray-200 dark:border-gray-800",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[!t.isRead&&e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>{N(t.id),c()},className:"gap-1.5",children:[e.jsx(T,{size:14}),"Mark as read"]}),e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>{f(t.id),c()},className:"gap-1.5 text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300",children:[e.jsx(I,{size:14}),"Delete"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{variant:"outline",size:"sm",onClick:c,children:"Close"}),e.jsxs(n,{variant:"default",size:"sm",onClick:()=>window.location.href=`mailto:${t.email}?subject=Re: ${t.subject}`,className:"gap-1.5",children:[e.jsx(be,{size:14}),"Reply"]})]})]})]})]})})]})})},es=()=>{const[t,x]=l.useState([]),[c,N]=l.useState([]),[f,b]=l.useState(""),[p,d]=l.useState("all"),[m,j]=l.useState(!1),[i,E]=l.useState(""),[w,C]=l.useState({open:!1,message:"",onConfirm:()=>{}}),[ke,U]=l.useState(null),[B,z]=l.useState(!1),[H,V]=l.useState(null);l.useEffect(()=>{F()},[]),l.useEffect(()=>{O()},[f,p,t]);const F=async()=>{j(!0),E("");try{const s=await fetch(`${k}Contact/all`,{credentials:"include"});if(!s.ok)throw new Error(`Error ${s.status}: ${s.statusText}`);const a=await s.json();if(a.success)x(a.data),N(a.data);else throw new Error(a.message||"Failed to fetch messages")}catch(s){console.error(s),E("Failed to load messages. Please try again later.")}finally{j(!1)}},O=()=>{let s=[...t];if(f){const a=f.toLowerCase();s=s.filter(r=>r.name.toLowerCase().includes(a)||r.email.toLowerCase().includes(a)||r.subject.toLowerCase().includes(a)||r.message.toLowerCase().includes(a))}if(p!=="all"){const a=p==="read";s=s.filter(r=>r.isRead===a)}N(s)},q=s=>{b(s.target.value)},X=s=>{d(s)},M=async s=>{try{const a=await fetch(`${k}Contact/${s}`,{method:"PUT",credentials:"include"});if(!a.ok)throw new Error(`Error ${a.status}: ${a.statusText}`);const r=await a.json();if(r.success)x(t.map(g=>g.id===s?{...g,isRead:!0}:g)),u.success("Message marked as read");else throw new Error(r.message||"Failed to mark message as read")}catch(a){console.error(a),u.error("Failed to mark message as read")}},_=async()=>{j(!0);try{const s=t.filter(h=>!h.isRead);if(s.length===0){u.info("All messages are already marked as read"),j(!1);return}const a=s.map(h=>fetch(`${k}Contact/${h.id}`,{method:"PUT",credentials:"include"}));if((await Promise.all(a)).every(h=>h.ok))x(t.map(h=>({...h,isRead:!0}))),u.success("All messages marked as read");else throw new Error("Some messages could not be marked as read")}catch(s){console.error(s),u.error("Failed to mark all messages as read")}finally{j(!1)}},G=async s=>{try{const a=await fetch(`${k}Contact/${s}`,{method:"DELETE",credentials:"include"});if(!a.ok)throw new Error(`Error ${a.status}: ${a.statusText}`);const r=await a.json();if(r.success)x(t.filter(g=>g.id!==s)),u.success("Message deleted successfully");else throw new Error(r.message||"Failed to delete message")}catch(a){console.error(a),u.error("Failed to delete message")}},A=s=>{U(s),C({open:!0,message:"Are you sure you want to delete this message?",onConfirm:()=>{G(s),C(a=>({...a,open:!1}))}})},L=s=>{V(s),z(!0),s.isRead||M(s.id)},J=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),K=s=>s?e.jsx(R,{variant:"outline",className:"text-gray-500",children:"Read"}):e.jsx(R,{className:"bg-blue-100 text-blue-800",children:"New"});return e.jsxs(ie,{children:[e.jsx("div",{className:"space-y-6",children:e.jsxs(W,{children:[e.jsx(Y,{className:"border-b",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(Z,{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5"}),"Messages Management"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(n,{variant:"outline",onClick:_,className:"gap-2",disabled:m||t.every(s=>s.isRead),children:[e.jsx(T,{size:16}),"Mark All as Read"]}),e.jsx(n,{variant:"outline",onClick:()=>{b(""),d("all"),F()},children:e.jsx(Ne,{size:16})})]})]})}),e.jsxs(ee,{className:"pt-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsx("div",{className:"relative flex-1",children:e.jsx(ae,{placeholder:"Search messages...",className:"pl-8",value:f,onChange:q})}),e.jsx("div",{className:"w-full md:w-48",children:e.jsxs(ce,{value:p,onValueChange:X,children:[e.jsx(oe,{className:"w-full",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{size:16}),e.jsx(de,{placeholder:"Filter"})]})}),e.jsxs(me,{children:[e.jsx(S,{value:"all",children:"All Messages"}),e.jsx(S,{value:"read",children:"Read"}),e.jsx(S,{value:"unread",children:"Unread"})]})]})})]}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(te,{children:[e.jsx(re,{children:e.jsxs(v,{children:[e.jsx(y,{children:"From"}),e.jsx(y,{children:"Contact"}),e.jsx(y,{children:"Subject"}),e.jsx(y,{children:"Date"}),e.jsx(y,{children:"Status"}),e.jsx(y,{className:"text-right",children:"Actions"})]})}),e.jsx(le,{children:m?e.jsx(v,{children:e.jsx(o,{colSpan:6,className:"text-center py-8",children:"Loading messages..."})}):i?e.jsx(v,{children:e.jsx(o,{colSpan:6,className:"text-center py-8 text-red-500",children:i})}):c.length===0?e.jsx(v,{children:e.jsx(o,{colSpan:6,className:"text-center py-8",children:"No messages found"})}):c.map(s=>e.jsxs(v,{className:s.isRead?"cursor-pointer":"bg-blue-50 cursor-pointer",onClick:()=>L(s),children:[e.jsxs(o,{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-sm text-muted-foreground line-clamp-1",children:s.email})]}),e.jsx(o,{children:e.jsx("div",{className:"text-sm",children:s.phone||"N/A"})}),e.jsxs(o,{children:[e.jsx("div",{className:"font-medium",children:s.subject}),e.jsx("div",{className:"text-sm text-muted-foreground line-clamp-1",children:s.message})]}),e.jsx(o,{children:e.jsx("div",{className:"text-sm",children:J(s.sentDate)})}),e.jsx(o,{children:K(s.isRead)}),e.jsx(o,{className:"text-right",onClick:a=>a.stopPropagation(),children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(n,{variant:"ghost",size:"sm",onClick:()=>L(s),children:[e.jsx(ye,{size:14,className:"mr-1"}),"View"]}),!s.isRead&&e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>M(s.id),children:[e.jsx(T,{size:14,className:"mr-1"}),"Read"]}),e.jsxs(n,{variant:"destructive",size:"sm",onClick:()=>A(s.id),children:[e.jsx(I,{size:14,className:"mr-1"}),"Delete"]})]})})]},s.id))})]})})]}),e.jsx(se,{className:"flex justify-between border-t",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",e.jsx("strong",{children:c.length})," of ",e.jsx("strong",{children:t.length})," messages"]})})]})}),w.open&&e.jsx(ne,{message:w.message,onConfirm:w.onConfirm,onCancel:()=>C({...w,open:!1})}),e.jsx(we,{message:H,isOpen:B,onClose:()=>z(!1),onMarkAsRead:M,onDelete:A})]})};export{es as default};
