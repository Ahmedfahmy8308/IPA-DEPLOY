import{r as l,a as x,j as r}from"./index-BrkXOzuL.js";import{d as p}from"./dayjs.min-wTeVztoK.js";import T from"./DashboardLayout-DVl20-_s.js";import{z as b,F as P,S as y,E as L,H as w,B as S,G as F}from"./AntdIcon-OpYKIL51.js";import{R as O}from"./SearchOutlined-CQ5rAT1e.js";import{D as z}from"./index-D_AKy5U6.js";import{T as M}from"./index-_ie_xSuP.js";import"./avatar-C3Qzir7c.js";import"./chevron-down-D5MiuktH.js";import"./menu-BMkDAQE4.js";import"./house-CtryE0pQ.js";import"./settings-D1KAJ9pn.js";import"./user-B-Iiemws.js";import"./proxy-DO2nrYZv.js";import"./index-CrE6lsot.js";import"./index-DcAOwtUU.js";var U={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M505.7 661a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V168c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"download",theme:"outlined"};function g(){return g=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var c=arguments[n];for(var s in c)Object.prototype.hasOwnProperty.call(c,s)&&(t[s]=c[s])}return t},g.apply(this,arguments)}const B=(t,n)=>l.createElement(b,g({},t,{ref:n,icon:U})),V=l.forwardRef(B);async function $(){try{const t=await fetch(`${x}StudentEnrollment`,{method:"GET",credentials:"include"});if(!t.ok)throw new Error("Network response was not ok");return(await t.json()).data}catch(t){console.error("Error fetching student enrollment data:",t)}}async function H(){try{const t=await fetch(`${x}StudentEnrollment/export-csv-all`,{method:"GET",credentials:"include"});if(!t.ok)throw new Error("Network response was not ok");const n=await t.blob(),c=window.URL.createObjectURL(n),s=document.createElement("a");s.href=c,s.download="student_enrollment.csv",s.click()}catch(t){console.error("Error downloading CSV file:",t)}}async function A(t){const n=await fetch(`${x}StudentEnrollment/toggle/${t}`,{method:"PUT",credentials:"include"});if(!n.ok)throw new Error("Network response was not ok");return(await n.json()).data}const{Search:Y}=L,{Option:f}=w,{RangePicker:_}=z,ce=()=>{const[t,n]=l.useState([]),[c,s]=l.useState(!0),[d,C]=l.useState(""),[m,I]=l.useState(null),[h,j]=l.useState(null),[u,E]=l.useState(null);l.useEffect(()=>{(async()=>{s(!0);try{const i=(await $()||[]).map(o=>({Id:o.id,CourseId:o.courseId,CourseName:o.courseName,Name:o.name,Phone:o.phone,Email:o.email,DateTime:o.dateTime,IsReaded:o.isReaded}));n(i)}catch(a){console.error("Error fetching data:",a)}finally{s(!1)}})()},[]);const v=l.useMemo(()=>t.filter(e=>{const a=d===""||e.Name.toLowerCase().includes(d.toLowerCase())||e.Email.toLowerCase().includes(d.toLowerCase())||e.Phone.includes(d)||e.CourseName.toLowerCase().includes(d.toLowerCase()),i=m===null||e.CourseName===m,o=h===null||e.IsReaded===h,R=u===null||p(e.DateTime).isAfter(u[0].startOf("day"))&&p(e.DateTime).isBefore(u[1].endOf("day"));return a&&i&&o&&R}),[t,d,m,h,u]),D=l.useMemo(()=>{const e=new Set(t.map(a=>a.CourseName));return Array.from(e)},[t]),N=()=>{H()},k=[{title:"ID",dataIndex:"Id",key:"Id",sorter:(e,a)=>e.Id-a.Id},{title:"Name",dataIndex:"Name",key:"Name",sorter:(e,a)=>e.Name.localeCompare(a.Name)},{title:"Course",dataIndex:"CourseName",key:"CourseName",sorter:(e,a)=>e.CourseName.localeCompare(a.CourseName)},{title:"Email",dataIndex:"Email",key:"Email"},{title:"Phone",dataIndex:"Phone",key:"Phone"},{title:"Date",dataIndex:"DateTime",key:"DateTime",render:e=>p(e).format("YYYY-MM-DD HH:mm"),sorter:(e,a)=>new Date(e.DateTime).getTime()-new Date(a.DateTime).getTime()},{title:"Status",dataIndex:"IsReaded",key:"IsReaded",render:e=>r.jsx(M,{color:e?"green":"orange",children:e?"Read":"Unread"}),filters:[{text:"Read",value:!0},{text:"Unread",value:!1}],onFilter:(e,a)=>a.IsReaded===e},{title:"Action",key:"action",render:(e,a)=>r.jsx(y,{size:"middle",children:r.jsx(S,{type:"link",onClick:async()=>{try{await A(a.Id),n(i=>i.map(o=>o.Id===a.Id?{...o,IsReaded:!o.IsReaded}:o))}catch(i){console.error("Failed to toggle status",i)}},children:"View"})})}];return r.jsx(T,{children:r.jsx("div",{className:"students-page",children:r.jsxs(P,{title:"Students Management",variant:!1,children:[r.jsx("div",{className:"filters-container",style:{marginBottom:20},children:r.jsxs(y,{size:"large",wrap:!0,children:[r.jsx(Y,{placeholder:"Search students...",allowClear:!0,enterButton:r.jsx(O,{}),size:"large",onSearch:e=>C(e),onChange:e=>C(e.target.value),style:{width:300}}),r.jsx(w,{placeholder:"Filter by course",allowClear:!0,style:{width:200},onChange:e=>I(e),children:D.map(e=>r.jsx(f,{value:e,children:e},e))}),r.jsxs(w,{placeholder:"Filter by status",allowClear:!0,style:{width:150},onChange:e=>j(e),children:[r.jsx(f,{value:!0,children:"Read"}),r.jsx(f,{value:!1,children:"Unread"})]}),r.jsx(_,{showTime:!0,style:{width:300},onChange:e=>E(e)}),r.jsx(S,{type:"primary",icon:r.jsx(V,{}),onClick:N,children:"Export CSV"})]})}),r.jsx(F,{columns:k,dataSource:v,rowKey:"Id",loading:c,pagination:{defaultPageSize:10,showSizeChanger:!0},scroll:{x:"max-content"},variant:!0})]})})})};export{ce as default};
