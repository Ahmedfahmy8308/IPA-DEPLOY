import{r as n,j as a,b as f,a as p,y as T}from"./index-Cyiel408.js";import{d as b}from"./dayjs.min-yZpyVJyO.js";import{C as B}from"./ConfirmationDialog-BeaAWITF.js";import{R as j}from"./FileTextOutlined-CysZF-hC.js";import{I as H}from"./AntdIcon-DkNVMiCV.js";import{R as x,a as y,M as E}from"./CloseOutlined-CLHErK8I.js";import{B as h,S as P}from"./index-D4qcYJUV.js";import{I as U,C as M}from"./index-CMOpGWy3.js";import{E as Q,F as _}from"./Table-DDNiuuBy.js";import"./index-LPtIBCFJ.js";import"./useClosable-DU12QjL7.js";import"./index-DcAOwtUU.js";var K={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 110.8V792H136V270.8l-27.6-21.5 39.3-50.5 42.8 33.3h643.1l42.8-33.3 39.3 50.5-27.7 21.5zM833.6 232L512 482 190.4 232l-42.8-33.3-39.3 50.5 27.6 21.5 341.6 265.6a55.99 55.99 0 0068.7 0L888 270.8l27.6-21.5-39.3-50.5-42.7 33.2z"}}]},name:"mail",theme:"outlined"};function S(){return S=Object.assign?Object.assign.bind():function(i){for(var o=1;o<arguments.length;o++){var c=arguments[o];for(var r in c)Object.prototype.hasOwnProperty.call(c,r)&&(i[r]=c[r])}return i},S.apply(this,arguments)}const q=(i,o)=>n.createElement(H,S({},i,{ref:o,icon:K})),D=n.forwardRef(q),oe=()=>{const[i,o]=n.useState([]),[c,r]=n.useState(!1),[l,R]=n.useState(""),[C,m]=n.useState(""),[F,I]=n.useState(!1),[d,$]=n.useState(null),[v,k]=n.useState(null),u={0:"Technical Issue",1:"Account Problem",2:"Billing Question",3:"Feedback",4:"Other",TechnicalIssue:"Technical Issue",Accountproblem:"Account Problem",BillingQuestion:"Billing Question",Feedback:"Feedback",Other:"Other"};n.useEffect(()=>{(async()=>{r(!0),m("");try{const t=await f.get(p+"SupportTicket",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});o(t.data.data||[])}catch{m("Failed to fetch tickets")}finally{r(!1)}})()},[]);const A=n.useMemo(()=>l?i.filter(e=>{var t,s,g;return((t=e.title)==null?void 0:t.toLowerCase().includes(l.toLowerCase()))||((s=e.email)==null?void 0:s.toLowerCase().includes(l.toLowerCase()))||((g=e.category)==null?void 0:g.toLowerCase().includes(l.toLowerCase()))}):i,[l,i]),w=n.useMemo(()=>{const e=i.length,t=i.filter(g=>g.read).length,s=e-t;return{total:e,read:t,unread:s}},[i]),L=async e=>{r(!0),m("");try{await f.put(p+`SupportTicket/${e}/mark-read`,{},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),o(t=>t.map(s=>s.id===e?{...s,read:!0,readAt:new Date().toISOString()}:s))}catch{m("Failed to mark as read")}finally{r(!1)}},Y=async e=>{r(!0),m("");try{await f.delete(p+`SupportTicket/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),o(t=>t.filter(s=>s.id!==e)),T.success("Ticket deleted successfully")}catch{m("Failed to delete ticket"),T.error("Failed to delete ticket")}finally{r(!1),k(null)}},z=e=>{$(e),I(!0)},V=async e=>{r(!0),m("");try{await f.put(p+`SupportTicket/${e}/mark-solved`,{},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),o(t=>t.map(s=>s.id===e?{...s,solve:!0,solvedAt:new Date().toISOString()}:s))}catch{m("Failed to mark as solved")}finally{r(!1)}},O=[{title:"Custom ID",dataIndex:"customId",key:"customId",sorter:(e,t)=>e.customId-t.customId,filteredValue:l?[l]:null,onFilter:(e,t)=>String(t.customId).includes(e)},{title:"Title",dataIndex:"title",key:"title",sorter:(e,t)=>e.title.localeCompare(t.title),filteredValue:l?[l]:null,onFilter:(e,t)=>{var s;return(s=t.title)==null?void 0:s.toLowerCase().includes(e.toLowerCase())},render:e=>a.jsxs("span",{children:[a.jsx(j,{className:"mr-1"}),e]})},{title:"Email",dataIndex:"email",key:"email",sorter:(e,t)=>e.email.localeCompare(t.email),filteredValue:l?[l]:null,onFilter:(e,t)=>{var s;return(s=t.email)==null?void 0:s.toLowerCase().includes(e.toLowerCase())},render:e=>a.jsxs("span",{children:[a.jsx(D,{className:"mr-1"}),e]})},{title:"Category",dataIndex:"category",key:"category",sorter:(e,t)=>(u[e.category]||e.category).localeCompare(u[t.category]||t.category),filters:Object.entries(u).filter(([e])=>!isNaN(Number(e))).map(([e,t])=>({text:t,value:e})),onFilter:(e,t)=>String(t.category)===String(e),render:e=>u[e]||e},{title:"Details",dataIndex:"details",key:"details",sorter:(e,t)=>e.details.localeCompare(t.details),filteredValue:l?[l]:null,onFilter:(e,t)=>{var s;return(s=t.details)==null?void 0:s.toLowerCase().includes(e.toLowerCase())}},{title:"Created At",dataIndex:"createdAt",key:"createdAt",sorter:(e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime(),render:e=>e?b(e).format("YYYY-MM-DD HH:mm"):"-"},{title:"Read At",dataIndex:"readAt",key:"readAt",sorter:(e,t)=>(e.readAt?new Date(e.readAt).getTime():0)-(t.readAt?new Date(t.readAt).getTime():0),render:e=>e?b(e).format("YYYY-MM-DD HH:mm"):"-"},{title:"Solved At",dataIndex:"solvedAt",key:"solvedAt",sorter:(e,t)=>(e.solvedAt?new Date(e.solvedAt).getTime():0)-(t.solvedAt?new Date(t.solvedAt).getTime():0),render:e=>e?b(e).format("YYYY-MM-DD HH:mm"):"-"},{title:"Read",dataIndex:"read",key:"read",sorter:(e,t)=>Number(e.read)-Number(t.read),filters:[{text:"Read",value:!0},{text:"Unread",value:!1}],onFilter:(e,t)=>t.read===e,render:e=>e?a.jsx(x,{}):a.jsx(y,{})},{title:"Solved",dataIndex:"solve",key:"solve",sorter:(e,t)=>Number(e.solve)-Number(t.solve),filters:[{text:"Solved",value:!0},{text:"Unsolved",value:!1}],onFilter:(e,t)=>t.solve===e,render:e=>e?a.jsx(x,{style:{color:"#52c41a"}}):a.jsx(y,{style:{color:"#f5222d"}})},{title:"Actions",key:"actions",render:(e,t)=>a.jsxs("div",{className:"flex space-x-2",children:[a.jsx(h,{icon:a.jsx(j,{}),onClick:()=>z(t),type:"default",size:"small",children:"View"}),a.jsx(h,{icon:a.jsx(x,{}),onClick:()=>L(t.id),disabled:t.read,type:"primary",size:"small",children:"Mark as Read"}),a.jsx(h,{icon:a.jsx(x,{}),onClick:()=>V(t.id),disabled:t.solve,type:"dashed",size:"small",children:"Mark as Solved"}),a.jsx(h,{icon:a.jsx(D,{}),onClick:()=>window.open(`mailto:${t.email}?subject=Re: ${t.title}`),type:"default",size:"small",children:"Reply"}),a.jsx(h,{icon:a.jsx(y,{}),danger:!0,onClick:()=>k(t.id),size:"small",children:"Delete"})]})}];return a.jsxs("div",{className:"tickets-dashboard p-6 min-h-screen bg-gradient-to-br from-blue-100 via-white to-blue-50",children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("h1",{className:"text-3xl font-extrabold text-blue-900 drop-shadow-lg tracking-tight",children:"Support Tickets"}),a.jsx("div",{className:"flex justify-between items-center mt-4",children:a.jsx("div",{className:"flex space-x-4",children:a.jsx(U,{placeholder:"Search tickets...",onChange:e=>R(e.target.value),className:"w-64 rounded-lg shadow border-blue-300 focus:border-blue-500 bg-white/80",allowClear:!0})})})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[a.jsx(N,{title:"Total Tickets",value:w.total,icon:a.jsx(j,{}),color:"#2563eb",bg:"bg-blue-200/60"}),a.jsx(N,{title:"Read",value:w.read,icon:a.jsx(x,{}),color:"#22c55e",bg:"bg-green-200/60"}),a.jsx(N,{title:"Unread",value:w.unread,icon:a.jsx(y,{}),color:"#ef4444",bg:"bg-red-200/60"})]}),a.jsx(M,{className:"rounded-2xl shadow-2xl border-0 bg-white/90",children:a.jsxs(P,{spinning:c,children:[C&&a.jsx("div",{className:"text-red-500 mb-2 font-semibold",children:C}),A.length===0?a.jsx(Q,{description:"No tickets found"}):a.jsx(_,{columns:O,dataSource:A,rowKey:"id",pagination:{pageSize:10},scroll:{x:"max-content"},bordered:!0,className:"rounded-xl shadow-md bg-white/90",rowClassName:(e,t)=>`${e.read?"bg-gray-100/80":"bg-white"} hover:bg-blue-100/60 transition-all duration-150 ${t%2===0?"even:bg-blue-50/40":""}`})]})}),a.jsx(E,{open:F,onCancel:()=>I(!1),footer:null,title:a.jsxs("span",{className:"flex items-center gap-2 text-xl font-bold text-blue-800",children:[a.jsx(j,{className:"text-blue-400"}),d?d.title:"Ticket Details"]}),width:600,className:"rounded-2xl",bodyStyle:{background:"#f3f6fa",borderRadius:"1rem"},children:d&&a.jsxs("div",{className:"space-y-4 p-1",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-start",children:[a.jsx("b",{className:"w-24 flex-shrink-0 text-blue-700",children:"Email:"}),a.jsx("span",{className:"text-gray-700",children:d.email})]}),a.jsxs("div",{className:"flex items-start",children:[a.jsx("b",{className:"w-24 flex-shrink-0 text-blue-700",children:"Category:"}),a.jsx("span",{className:"text-gray-700",children:u[d.category]||d.category})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-start",children:[a.jsx("b",{className:"w-24 flex-shrink-0 text-blue-700",children:"Created At:"}),a.jsx("span",{className:"text-gray-700",children:b(d.createdAt).format("YYYY-MM-DD HH:mm")})]}),a.jsxs("div",{className:"flex items-start",children:[a.jsx("b",{className:"w-24 flex-shrink-0 text-blue-700",children:"Status:"}),a.jsx("span",{className:`font-medium ${d.read?"text-green-600":"text-orange-600"}`,children:d.read?"Read":"Unread"})]})]})]}),a.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[a.jsx("div",{className:"font-semibold text-gray-800 mb-2",children:"Details:"}),a.jsx("div",{className:"bg-white p-4 rounded-md text-gray-700 whitespace-pre-line border border-gray-200 shadow-inner",children:d.details})]})]})}),!!v&&a.jsx(B,{visible:!!v,title:"Delete Ticket",description:"Are you sure you want to delete this ticket? This action cannot be undone.",onCancel:()=>k(null),onConfirm:()=>Y(v),confirmText:"Delete",confirmButtonProps:{danger:!0},loading:c})]})},N=({title:i,value:o,icon:c,color:r,bg:l})=>a.jsxs(M,{className:`flex items-center p-4 shadow-md border-0 rounded-xl ${l||"bg-gray-100"}`,children:[a.jsx("div",{className:"mr-4",children:a.jsx("span",{style:{color:r,fontSize:28},children:c})}),a.jsxs("div",{children:[a.jsx("div",{className:"text-2xl font-extrabold",style:{color:r},children:o}),a.jsx("div",{className:"text-gray-600 font-medium",children:i})]})]});export{oe as default};
