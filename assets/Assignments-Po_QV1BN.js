import{r as n,b as f,a as p,j as e}from"./index-BFIRCOFm.js";import{d as ie}from"./dayjs.min-DXzorgZG.js";import{s as x,R as re,a as oe,F as u}from"./EditOutlined-BK2_iqAv.js";import{a as b,E as le,F as ce}from"./Table-DEG_g8U6.js";import{I as F,C as Y}from"./index-CPYBInz1.js";import{R as de}from"./SearchOutlined-DIxDe8DV.js";import{R as V,D as ue}from"./TeamOutlined-5HVsqqXd.js";import{R as q,a as B,M as me}from"./CloseOutlined-BmO1FBva.js";import{S as xe,B as N}from"./index-CpFwwJTZ.js";import{R as he}from"./FileTextOutlined-DfZfWF8f.js";import{D as fe}from"./index-rbULvauT.js";import"./index-CreNBxjw.js";import"./AntdIcon-F9Ue1WPK.js";import"./useClosable-DjP6elIW.js";import"./index-DcAOwtUU.js";const{Option:m}=b,I={excellent:4,good:3,average:2,needs_improvement:1},pe={4:"Excellent",3:"Good",2:"Average",1:"Needs improvement"},$e=()=>{const[a,j]=n.useState([]),[g,v]=n.useState([]),[d,h]=n.useState([]),[o,E]=n.useState([]),[P,r]=n.useState(!1),[i,C]=n.useState(""),[y,O]=n.useState(""),[l,M]=n.useState(""),[U,R]=n.useState(!1),[_,T]=n.useState(null),[$,z]=n.useState("create"),[K,D]=n.useState([]),[L,H]=n.useState("");n.useEffect(()=>{J(),W()},[]),n.useEffect(()=>{y?Q(y):v([])},[y]),n.useEffect(()=>{l?G(l):h([])},[l]),n.useEffect(()=>{D(L?d.filter(s=>{var t,S;return(S=(t=o.find(w=>w.id===s.studentId))==null?void 0:t.fullName)==null?void 0:S.toLowerCase().includes(L.toLowerCase())}):d)},[L,d,o]);const J=async()=>{r(!0);try{const s=await f.get(`${p}Group`);j(s.data.data||[])}catch{C("Failed to load groups"),x.error("Failed to load groups")}r(!1)},Q=async s=>{r(!0);try{const t=await f.get(`${p}GroupLesson/${s}/sessions`);v(t.data.data||[])}catch{C("Failed to load sessions"),x.error("Failed to load sessions")}r(!1)},G=async s=>{r(!0);try{const t=await f.get(`${p}GroupAssignments/sessions/${s}/submissions`);h(t.data.data||[]),D(t.data.data||[])}catch{C("Failed to load submissions"),x.error("Failed to load submissions")}r(!1)},W=async()=>{try{const s=await f.get(`${p}User/students`);E(s.data.data||[])}catch{}},k=n.useMemo(()=>{const s=d.length,t=d.filter(c=>c.wasPresent).length,S=s-t,w=d.map(c=>typeof c.evaluationScore=="number"?c.evaluationScore:I[c.evaluationScore]).filter(c=>typeof c=="number"&&!isNaN(c)),ne=w.length>0?(w.reduce((c,ae)=>c+ae,0)/w.length).toFixed(1):0;return{total:s,present:t,absent:S,avgScore:ne}},[d]),X=s=>{H(s)},Z=s=>{z("edit"),T(s),R(!0)},ee=async s=>{r(!0);try{await f.delete(`${p}GroupAssignments/submissions/${s}`),x.success("Submission deleted successfully!"),G(l)}catch{x.error("Failed to delete submission")}r(!1)},se=async s=>{r(!0);try{let t;$==="create"?(t={...s,sessionId:l},t.evaluationScore in I&&(t.evaluationScore=I[t.evaluationScore]),console.log("Submission payload (create):",t),await f.post(`${p}GroupAssignments/sessions/${l}/submissions`,t),x.success("Submission added successfully!")):(t={wasPresent:s.wasPresent,evaluationScore:s.evaluationScore,bonusPoints:s.bonusPoints,comments:s.comments},console.log("Submission payload (edit):",t),await f.put(`${p}GroupAssignments/submissions/${_.id}`,t),x.success("Submission updated successfully!")),R(!1),G(l)}catch{x.error("Failed to save submission")}r(!1)},te=[{title:"Student",dataIndex:"studentId",key:"studentId",render:s=>{var t;return((t=o.find(S=>S.id===s))==null?void 0:t.fullName)||s}},{title:"Submission Link",dataIndex:"submissionLink",key:"submissionLink",render:s=>s?e.jsx("a",{href:s,target:"_blank",rel:"noopener noreferrer",children:e.jsx(he,{})}):"-"},{title:"Attendance",dataIndex:"wasPresent",key:"wasPresent",render:s=>s===!0?e.jsxs("span",{children:[e.jsx(q,{title:"Present",style:{color:"#52c41a",marginRight:4}}),"Present"]}):s==="late"?e.jsxs("span",{children:[e.jsx("span",{style:{color:"#faad14",marginRight:4},children:"â°"}),"Late"]}):e.jsxs("span",{children:[e.jsx(B,{title:"Absent",style:{color:"#f5222d",marginRight:4}}),"Absent"]})},{title:"Evaluation",dataIndex:"evaluationScore",key:"evaluationScore",render:s=>typeof s=="number"?pe[s]||s:s==="excellent"?"Excellent":s==="good"?"Good":s==="average"?"Average":s==="needs_improvement"?"Needs improvement":s||"-"},{title:"Bonus",dataIndex:"bonusPoints",key:"bonusPoints"},{title:"Date",dataIndex:"submissionDate",key:"submissionDate"},{title:"Comments",dataIndex:"comments",key:"comments"},{title:"Actions",key:"actions",render:(s,t)=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(N,{icon:e.jsx(re,{}),onClick:()=>Z(t)}),e.jsx(N,{icon:e.jsx(oe,{}),danger:!0,onClick:()=>ee(t.id)})]})}];return e.jsxs("div",{className:"assignment-dashboard p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Assignment Submissions"}),e.jsx("div",{className:"flex justify-between items-center mt-4",children:e.jsxs("div",{className:"flex space-x-4",children:[e.jsx(b,{placeholder:"Select group",style:{width:200},value:y,onChange:s=>{O(s),M("")},allowClear:!0,showSearch:!0,optionFilterProp:"children",children:a.map(s=>e.jsx(m,{value:s.id,children:s.name},s.id))}),e.jsx(b,{placeholder:"Select session",style:{width:200},value:l,onChange:M,allowClear:!0,showSearch:!0,optionFilterProp:"children",disabled:!y,children:g.map(s=>e.jsx(m,{value:s.id,children:s.title},s.id))}),e.jsx(F,{placeholder:"Search student...",prefix:e.jsx(de,{}),onChange:s=>X(s.target.value),className:"w-64",disabled:!l})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(A,{title:"Total Submissions",value:k.total,icon:e.jsx(V,{}),color:"#1890ff"}),e.jsx(A,{title:"Present",value:k.present,icon:e.jsx(q,{}),color:"#52c41a"}),e.jsx(A,{title:"Absent",value:k.absent,icon:e.jsx(B,{}),color:"#f5222d"}),e.jsx(A,{title:"Avg Score",value:k.avgScore,icon:e.jsx(V,{}),color:"#faad14"})]}),e.jsx(Y,{children:e.jsx(xe,{spinning:P,children:i?e.jsx(le,{description:i}):e.jsx(ce,{columns:te,dataSource:K,rowKey:"id",pagination:{pageSize:10},scroll:{x:"max-content"}})})}),e.jsx(me,{title:$==="create"?"Add Submission":"Edit Submission",open:U,onCancel:()=>R(!1),footer:null,width:700,destroyOnClose:!0,children:e.jsx(Se,{submission:_,students:o,sessions:g,selectedSessionId:l,onSubmit:se,actionType:$})})]})},A=({title:a,value:j,icon:g,color:v})=>e.jsxs(Y,{className:"flex items-center p-4",children:[e.jsx("div",{className:"mr-4",children:e.jsx("span",{style:{color:v},children:g})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold",children:j}),e.jsx("div",{className:"text-gray-500",children:a})]})]}),Se=({submission:a,students:j,sessions:g,selectedSessionId:v,onSubmit:d,actionType:h})=>{const[o]=u.useForm(),[E,P]=n.useState(!1);n.useEffect(()=>{a?o.setFieldsValue({studentId:a.studentId,submissionLink:a.submissionLink,wasPresent:a.wasPresent===!0?!0:a.wasPresent===!1?!1:a.wasPresent==="late"?"late":void 0,evaluationScore:typeof a.evaluationScore=="number"?Object.keys(I).find(i=>I[i]===a.evaluationScore):a.evaluationScore,bonusPoints:a.bonusPoints,submissionDate:a.submissionDate?ie(a.submissionDate):null,comments:a.comments}):o.resetFields()},[a,o]);const r=async()=>{try{P(!0);const i=await o.validateFields();await d({...i,wasPresent:i.wasPresent===!0?!0:i.wasPresent===!1?!1:i.wasPresent==="late"?"late":void 0,submissionDate:i.submissionDate?i.submissionDate.format("YYYY-MM-DD"):""})}catch{}finally{P(!1)}};return e.jsxs(u,{form:o,layout:"vertical",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(u.Item,{name:"studentId",label:"Student",rules:[{required:!0,message:"Please select a student"}],children:e.jsx(b,{placeholder:"Select student",showSearch:!0,optionFilterProp:"children",disabled:h==="edit",children:j.map(i=>e.jsx(m,{value:i.id,children:i.fullName},i.id))})}),e.jsx(u.Item,{name:"submissionLink",label:"Submission Link",rules:[{required:!0,message:"Please input submission link"}],children:e.jsx(F,{placeholder:"Enter submission link",disabled:h==="edit"})}),e.jsx(u.Item,{name:"wasPresent",label:"Attendance",rules:[{required:!0,message:"Please select attendance"}],children:e.jsxs(b,{children:[e.jsx(m,{value:!0,children:"Present"}),e.jsx(m,{value:!1,children:"Absent"})]})}),e.jsx(u.Item,{name:"evaluationScore",label:"Evaluation",rules:[{required:!0,message:"Please select evaluation"}],children:e.jsxs(b,{placeholder:"Select evaluation",children:[e.jsx(m,{value:"excellent",children:"Excellent"}),e.jsx(m,{value:"good",children:"Good"}),e.jsx(m,{value:"average",children:"Average"}),e.jsx(m,{value:"needs_improvement",children:"Needs improvement"})]})}),e.jsx(u.Item,{name:"bonusPoints",label:"Bonus Points",children:e.jsx(F,{type:"number",placeholder:"Enter bonus points",min:0})}),e.jsx(u.Item,{name:"submissionDate",label:"Submission Date",children:e.jsx(fe,{style:{width:"100%"},disabled:h==="edit"})}),e.jsx(u.Item,{name:"comments",label:"Comments",children:e.jsx(F.TextArea,{placeholder:"Enter comments"})})]}),e.jsx(ue,{}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(N,{onClick:()=>o.resetFields(),children:"Reset"}),e.jsx(N,{type:"primary",onClick:r,loading:E,children:h==="create"?"Add Submission":"Update Submission"})]})]})};export{$e as default};
